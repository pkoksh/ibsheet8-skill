<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>IBSheet 읽기 전용 그리드</title>
  <script src="ibsheet/ibsheet.js"></script>
  <link rel="stylesheet" href="ibsheet/css/ibsheet.css">
  <style>
    body { font-family: 'Malgun Gothic', sans-serif; margin: 20px; }
    .toolbar { margin-bottom: 10px; }
    .toolbar input { padding: 8px; width: 200px; }
    .toolbar button { padding: 8px 16px; margin-left: 5px; cursor: pointer; }
    #sheetContainer { width: 100%; height: 500px; }
    .summary { margin-top: 10px; padding: 10px; background: #f5f5f5; }
  </style>
</head>
<body>
  <h1>조회용 그리드</h1>
  
  <div class="toolbar">
    <input type="text" id="keyword" placeholder="검색어 입력...">
    <button onclick="search()">검색</button>
    <button onclick="exportExcel()">엑셀 다운로드</button>
    <button onclick="print()">인쇄</button>
  </div>
  
  <div id="sheetContainer"></div>
  
  <div class="summary">
    총 <strong id="totalCount">0</strong>건 | 
    합계: <strong id="totalAmount">0</strong>원
  </div>

  <script>
    let sheet;
    
    document.addEventListener("DOMContentLoaded", function() {
      IBSheet.create({
        id: "sheet",
        el: "sheetContainer",
        options: {
          Cfg: {
            SearchMode: 2,
            CanEdit: false,
            CanSort: true,
            CanFilter: true
          },
          Cols: [
            { Header: "No", Name: "_rowNum", Type: "RowNum", Width: 50 },
            { Header: "주문번호", Name: "orderNo", Type: "Text", Width: 100 },
            { Header: "고객명", Name: "customerName", Type: "Text", Width: 100 },
            { Header: "상품명", Name: "productName", Type: "Text", Width: 150 },
            { Header: "수량", Name: "quantity", Type: "Int", Width: 80, Align: "Right" },
            { Header: "단가", Name: "price", Type: "Int", Width: 100, Align: "Right", Format: "#,##0" },
            { Header: "금액", Name: "amount", Type: "Int", Width: 100, Align: "Right", Format: "#,##0" },
            { Header: "상태", Name: "status", Type: "Text", Width: 80, Align: "Center" },
            { Header: "주문일", Name: "orderDate", Type: "Date", Width: 100, Format: "yyyy-MM-dd" }
          ],
          Events: {
            onRenderFirstFinish: function(evt) {
              sheet = this;
              loadData();
            },
            onDblClick: function(evt) {
              alert("상세보기: " + this.getValue(evt.row, "orderNo"));
            }
          }
        }
      });
    });
    
    function loadData() {
      // 실제로는 서버에서 조회
      const data = [
        { orderNo: "ORD-001", customerName: "홍길동", productName: "노트북", quantity: 1, price: 1500000, amount: 1500000, status: "완료", orderDate: "2024-01-15" },
        { orderNo: "ORD-002", customerName: "김철수", productName: "마우스", quantity: 5, price: 25000, amount: 125000, status: "배송중", orderDate: "2024-01-18" },
        { orderNo: "ORD-003", customerName: "이영희", productName: "키보드", quantity: 2, price: 80000, amount: 160000, status: "준비중", orderDate: "2024-01-20" }
      ];
      
      sheet.loadSearchData({ data: data });
      updateSummary();
    }
    
    function search() {
      const keyword = document.getElementById("keyword").value;
      if (keyword) {
        sheet.setFilter("customerName", keyword);
      } else {
        sheet.clearAllFilter();
      }
      updateSummary();
    }
    
    function updateSummary() {
      const rows = sheet.getAllRows();
      let total = 0;
      rows.forEach(row => total += sheet.getValue(row, "amount") || 0);
      
      document.getElementById("totalCount").textContent = rows.length;
      document.getElementById("totalAmount").textContent = total.toLocaleString();
    }
    
    function exportExcel() {
      sheet.exportExcel({ fileName: "주문목록" });
    }
    
    function print() {
      sheet.print({ title: "주문 목록" });
    }
  </script>
</body>
</html>
